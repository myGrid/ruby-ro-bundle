<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class ROBundle::File -  Research Object Bundle Ruby Library version 0.1.0</title>

<link href="../fonts.css" rel="stylesheet">
<link href="../rdoc.css" rel="stylesheet">

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/navigation.js"></script>
<script src="../js/search_index.js"></script>
<script src="../js/search.js"></script>
<script src="../js/searcher.js"></script>
<script src="../js/darkfish.js"></script>


<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">UCF::File
  
</div>

    
    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">Forwardable</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li class="calls-super" ><a href="#method-c-create">::create</a>
    
    <li class="calls-super" ><a href="#method-i-add">#add</a>
    
    <li ><a href="#method-i-add_aggregate">#add_aggregate</a>
    
    <li ><a href="#method-i-add_annotation">#add_annotation</a>
    
    <li ><a href="#method-i-add_history">#add_history</a>
    
    <li ><a href="#method-i-aggregate-3F">#aggregate?</a>
    
    <li ><a href="#method-i-annotatable-3F">#annotatable?</a>
    
    <li ><a href="#method-i-annotation-3F">#annotation?</a>
    
    <li ><a href="#method-i-close">#close</a>
    
    <li class="calls-super" ><a href="#method-i-commit">#commit</a>
    
    <li class="calls-super" ><a href="#method-i-commit_required-3F">#commit_required?</a>
    
    <li class="calls-super" ><a href="#method-i-find_entry">#find_entry</a>
    
    <li class="calls-super" ><a href="#method-i-remove">#remove</a>
    
    <li ><a href="#method-i-remove_aggregate">#remove_aggregate</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-ROBundle::File">
  <h1 id="class-ROBundle::File" class="class">
    class ROBundle::File
  </h1>

  <section class="description">
    
<p>This class represents a Research Object Bundle file. See the <a
href="https://w3id.org/bundle/">RO Bundle specification</a> for more
details.</p>

<p>Many of the methods that this class provides are actually implemented in
the <a href="Manifest.html">Manifest</a> class, so please see its
documentation for details.</p>

  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    

    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-create" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            create(filename) &rarr; File
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            create(filename, mimetype) &rarr; File
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            create(filename) {|file| ...}
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            create(filename, mimetype) {|file| ...}
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Create a new RO Bundle file on disk and open it for editing. A custom
mimetype for the bundle may be specified but is unnecessary if the default,
“application/vnd.wf4ever.robundle+zip”, will be used.</p>

<p>Please see the <a href="http://mygrid.github.io/ruby-ucf/">UCF
documentation</a> for much more information and a list of all the other
methods available in this class. RDoc does not list inherited methods,
unfortunately.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="create-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 60</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">create</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">mimetype</span> = <span class="ruby-constant">MIMETYPE</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">filename</span>, <span class="ruby-identifier">mimetype</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">block</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-add" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            add(entry, src_path, options = {}, &amp;continue_on_exists_proc) &rarr; Aggregate or nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Convenience method for adding the contents of a file to the bundle file. If
asked to add a file with a reserved name, such as the special mimetype
header file or .ro/manifest.json, this method will raise a
ReservedNameClashError.</p>

<p>This method automatically adds new entries to the list of bundle aggregates
unless the <code>:aggregate</code> option is set to false.</p>

<p>If the added entry is aggregated then the <a
href="Aggregate.html">Aggregate</a> object is returned, otherwise
<code>nil</code> is returned.</p>

<p>See the rubyzip documentation for details of the
<code>continue_on_exists_proc</code> parameter.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="add-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span>, <span class="ruby-identifier">options</span> = {}, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)

  <span class="ruby-identifier">options</span> = { <span class="ruby-value">:aggregate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">true</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:aggregate</span>]
    <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">add_aggregate</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-add_aggregate" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            add_aggregate(uri) &rarr; Aggregate
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_aggregate(entry) &rarr; Aggregate
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_aggregate(entry, src_path, &amp;continue_on_exists_proc) &rarr; Aggregate
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>The first form of this method adds a URI as an aggregate of the bundle.</p>

<p>The second form adds an already existing entry in the bundle to the list of
aggregates. <code>Errno:ENOENT</code> is raised if the entry does not
exist.</p>

<p>The third form is equivalent to <a href="File.html#method-i-add">#add</a>
called without any options.</p>

<p>In all cases the <a href="Aggregate.html">Aggregate</a> object added to the
Research Object is returned.</p>
          
          

          
          <div class="method-source-code" id="add_aggregate-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 105</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_aggregate</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">src_path</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">add_aggregate</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">add</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-add_annotation" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(annotation_object) &rarr; Annotation
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(aggregate, content, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(aggregate, file, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(aggregate, uri, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(uri, content, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(uri, file, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(uri, uri, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(annotation, content, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(annotation, file, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_annotation(annotation, uri, options = {}) &rarr; Annotation
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>This method has two forms.</p>

<p>The first form registers an already initialized <a
href="Annotation.html">Annotation</a> object in this Research Object.</p>

<p>The second form creates a new <a href="Annotation.html">Annotation</a>
object for the specified target with the specified (or empty content) and
registers it in this Research Object.</p>

<p>In both cases <code>Errno:ENOENT</code> is raised if the target of the
annotation is not an annotatable resource.</p>

<p>The <a href="Annotation.html">Annotation</a> object added to the Research
Object is returned.</p>
          
          

          
          <div class="method-source-code" id="add_annotation-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 138</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_annotation</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">body</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">options</span> = { <span class="ruby-value">:aggregate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">target</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Annotation</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">annotatable?</span>(<span class="ruby-identifier">target</span>)
    <span class="ruby-keyword">if</span> <span class="ruby-identifier">body</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">aggregate?</span>(<span class="ruby-identifier">body</span>)
      <span class="ruby-identifier">content</span> = <span class="ruby-identifier">body</span>
    <span class="ruby-keyword">elsif</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">is_absolute_uri?</span>(<span class="ruby-identifier">body</span>)
      <span class="ruby-identifier">content</span> = <span class="ruby-identifier">body</span>
      <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">add_aggregate</span>(<span class="ruby-identifier">body</span>) <span class="ruby-keyword">if</span> <span class="ruby-identifier">options</span>[<span class="ruby-value">:aggregate</span>]
    <span class="ruby-keyword">else</span>
      <span class="ruby-identifier">content</span> = <span class="ruby-ivar">@ro_dir</span>.<span class="ruby-identifier">write_annotation_data</span>(<span class="ruby-identifier">body</span>, <span class="ruby-identifier">options</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">add_annotation</span>(<span class="ruby-identifier">target</span>, <span class="ruby-identifier">content</span>)
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">raise</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">ENOENT</span>,
      <span class="ruby-node">&quot;'#{target}' is not a member of this Research Object or a URI.&quot;</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-add_history" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            add_history(entry)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            add_history(entry, src_path, &amp;continue_on_exists_proc)
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>The first form of this method adds an already existing entry in the bundle
to the history list in the manifest. <code>Errno:ENOENT</code> is raised if
the entry does not exist.</p>

<p>The second form adds the entry before adding it to the history list. The
entry is not aggregated.</p>
          
          

          
          <div class="method-source-code" id="add_history-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 168</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">add_history</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span> = <span class="ruby-keyword">nil</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">src_path</span>.<span class="ruby-identifier">nil?</span>
    <span class="ruby-identifier">add</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">src_path</span>, <span class="ruby-value">:aggregate</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span>, <span class="ruby-operator">&amp;</span><span class="ruby-identifier">continue_on_exists_proc</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">add_history</span>(<span class="ruby-identifier">entry</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-aggregate-3F" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            aggregate?(uri) &rarr; true or false
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            aggregate?(entry) &rarr; true or false
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Is the supplied URI or entry aggregated in this Research Object?</p>
          
          

          
          <div class="method-source-code" id="aggregate-3F-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 181</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">aggregate?</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">==</span> <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">id</span>

  <span class="ruby-keyword">if</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">is_absolute_uri?</span>(<span class="ruby-identifier">entry</span>)
    <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">entry</span>.<span class="ruby-identifier">to_s</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">entry</span> = <span class="ruby-identifier">entry_name</span>(<span class="ruby-identifier">entry</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">aggregates</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">agg</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">uri</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">||</span>
      <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">file</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span> <span class="ruby-operator">||</span>
      <span class="ruby-identifier">agg</span>.<span class="ruby-identifier">file_entry</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">entry</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-annotatable-3F" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            annotatable?(target) &rarr; true or false
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Is the supplied target an annotatable resource? An annotatable resource is
either an absolute URI (which may or may not be aggregated in the RO), an
aggregated resource or another registered annotation.</p>
          
          

          
          <div class="method-source-code" id="annotatable-3F-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 205</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">annotatable?</span>(<span class="ruby-identifier">target</span>)
  <span class="ruby-constant">Util</span>.<span class="ruby-identifier">is_absolute_uri?</span>(<span class="ruby-identifier">target</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">annotation?</span>(<span class="ruby-identifier">target</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">aggregate?</span>(<span class="ruby-identifier">target</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-annotation-3F" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            annotation?(id) &rarr; true or false
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            annotation?(annotation) &rarr; true or false
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Is the supplied id or annotation registered in this Research Object?</p>
          
          

          
          <div class="method-source-code" id="annotation-3F-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 214</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">annotation?</span>(<span class="ruby-identifier">id</span>)
  <span class="ruby-identifier">id</span> = <span class="ruby-identifier">id</span>.<span class="ruby-identifier">annotation_id</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">instance_of?</span>(<span class="ruby-constant">Annotation</span>)

  <span class="ruby-identifier">annotations</span>.<span class="ruby-identifier">each</span> <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">ann</span><span class="ruby-operator">|</span>
    <span class="ruby-keyword">return</span> <span class="ruby-keyword">true</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">ann</span>.<span class="ruby-identifier">annotation_id</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">id</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">false</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-close" class="method-detail method-alias">
        
        <div class="method-heading">
          <span class="method-name">close</span><span
            class="method-args">()</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
        </div>

        

        
        <div class="aliases">
          Alias for: <a href="File.html#method-i-commit">commit</a>
        </div>
        
      </div>

    
      <div id="method-i-commit" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            commit &rarr; true or false
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            close &rarr; true or false
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Commits changes that have been made since the previous commit to the RO
Bundle file. Returns <code>true</code> if anything was actually done,
<code>false</code> otherwise.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="commit-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 231</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">commit</span>
  <span class="ruby-keyword">if</span> <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">edited?</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">full_name</span>
    <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">name</span>, <span class="ruby-keyword">true</span>) <span class="ruby-keyword">unless</span> <span class="ruby-identifier">find_entry</span>(<span class="ruby-identifier">name</span>).<span class="ruby-identifier">nil?</span>

    <span class="ruby-identifier">file</span>.<span class="ruby-identifier">open</span>(<span class="ruby-identifier">name</span>, <span class="ruby-string">&quot;w&quot;</span>) <span class="ruby-keyword">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">m</span><span class="ruby-operator">|</span>
      <span class="ruby-identifier">m</span>.<span class="ruby-identifier">puts</span> <span class="ruby-constant">JSON</span>.<span class="ruby-identifier">pretty_generate</span>(<span class="ruby-ivar">@manifest</span>)
    <span class="ruby-keyword">end</span>

    <span class="ruby-ivar">@ro_dir</span>.<span class="ruby-identifier">cleanup_annotation_data</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">super</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        
        <div class="aliases">
          Also aliased as: <a href="File.html#method-i-close">close</a>
        </div>
        

        
      </div>

    
      <div id="method-i-commit_required-3F" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            commit_required? &rarr; true or false
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Returns <code>true</code> if any changes have been made to this RO Bundle
file since the last commit, <code>false</code> otherwise.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="commit_required-3F-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 253</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">commit_required?</span>
  <span class="ruby-keyword">super</span> <span class="ruby-operator">||</span> <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">edited?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-find_entry" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            find_entry(entry_name, options = {}) &rarr; Zip::Entry or nil
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Searches for the entry with the specified name. Returns <code>nil</code> if
no entry is found or if the specified entry is hidden for normal use. You
can specify <code>:include_hidden =&gt; true</code> to include hidden
entries in the search.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="find_entry-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 264</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">find_entry</span>(<span class="ruby-identifier">entry_name</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">if</span> <span class="ruby-constant">Util</span>.<span class="ruby-identifier">is_absolute_uri?</span>(<span class="ruby-identifier">entry_name</span>)

  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">entry_name</span>, <span class="ruby-identifier">options</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-remove" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            remove(entry)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Removes the specified entry from the Research Object bundle. If asked to
remove any reserved files such as the special mimetype header file this
method will do nothing.</p>

<p>If the entry being removed is aggregated in this RO then the aggregation is
removed. All annotations that refer to the removed entry are also removed.</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="remove-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 280</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">entry</span>, <span class="ruby-identifier">preserve_manifest</span> = <span class="ruby-keyword">false</span>)
  <span class="ruby-keyword">super</span>(<span class="ruby-identifier">entry</span>)

  <span class="ruby-comment"># The preserve manifest flag is STRICTLY for internal use only.</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">preserve_manifest</span>
    <span class="ruby-identifier">name</span> = <span class="ruby-identifier">entry_name</span>(<span class="ruby-identifier">entry</span>)
    <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">remove_aggregate</span>(<span class="ruby-node">&quot;/#{name}&quot;</span>)
    <span class="ruby-identifier">remove_annotation</span>(<span class="ruby-node">&quot;/#{name}&quot;</span>)
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-remove_aggregate" class="method-detail ">
        
        
        <div class="method-heading">
          <span class="method-callseq">
            remove_aggregate(entry)
          </span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            remove_aggregate(uri)
          </span>
          
        </div>
        
        <div class="method-heading">
          <span class="method-callseq">
            remove_aggregate(Aggregate)
          </span>
          
        </div>
        
        

        <div class="method-description">
          
          <p>Remove (unregister) an aggregate from this Research Object. If it is a file
then the file is no longer aggregated, and it is deleted from the bundle by
this method unless the option <code>:keep_file =&gt; true</code> is
supplied.</p>

<p>Any annotations with the removed aggregate as their target are also removed
from the RO.</p>
          
          

          
          <div class="method-source-code" id="remove_aggregate-source">
            <pre><span class="ruby-comment"># File lib/ro-bundle/file.rb, line 303</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_aggregate</span>(<span class="ruby-identifier">object</span>, <span class="ruby-identifier">options</span> = {})
  <span class="ruby-identifier">options</span> = { <span class="ruby-value">:keep_file</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword">false</span> }.<span class="ruby-identifier">merge</span>(<span class="ruby-identifier">options</span>)
  <span class="ruby-identifier">file</span> = <span class="ruby-keyword">nil</span>

  <span class="ruby-keyword">if</span> <span class="ruby-identifier">object</span>.<span class="ruby-identifier">is_a?</span>(<span class="ruby-constant">Aggregate</span>)
    <span class="ruby-identifier">file</span> = <span class="ruby-identifier">object</span>.<span class="ruby-identifier">file_entry</span>
  <span class="ruby-keyword">elsif</span> <span class="ruby-operator">!</span><span class="ruby-constant">Util</span>.<span class="ruby-identifier">is_absolute_uri?</span>(<span class="ruby-identifier">object</span>)
    <span class="ruby-identifier">object</span> = <span class="ruby-identifier">entry_name</span>(<span class="ruby-identifier">object</span>)
    <span class="ruby-identifier">file</span> = <span class="ruby-constant">Util</span>.<span class="ruby-identifier">strip_leading_slash</span>(<span class="ruby-identifier">object</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">if</span> <span class="ruby-operator">!</span><span class="ruby-identifier">file</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>[<span class="ruby-value">:keep_file</span>]
    <span class="ruby-identifier">remove</span>(<span class="ruby-identifier">file</span>, <span class="ruby-keyword">true</span>)
  <span class="ruby-keyword">end</span>

  <span class="ruby-ivar">@manifest</span>.<span class="ruby-identifier">remove_aggregate</span>(<span class="ruby-identifier">object</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://rdoc.rubyforge.org">RDoc</a> 4.1.1.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-Rdoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

